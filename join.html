<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Join Tournament - CrickMatch</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Inter', sans-serif; }
        .bg-purple-main { background-color: #4A3A8C; }
    </style>
</head>
<body class="bg-gray-100 flex items-center justify-center min-h-screen p-6">

    <!-- 1. PC/Desktop Message (Hidden by default) -->
    <div id="pc-error" class="hidden bg-white p-8 rounded-3xl shadow-xl max-w-sm w-full text-center">
        <div class="text-5xl mb-4">üì±</div>
        <h1 class="text-xl font-bold mb-2 text-gray-800">Mobile Only Link</h1>
        <p class="text-gray-500 text-sm mb-4">
            This invitation link can only be opened on a mobile device. 
            Please open this URL on your smartphone to join the tournament.
        </p>
        <div class="p-3 bg-yellow-50 text-yellow-700 text-[11px] rounded-lg border border-yellow-100 font-medium">
            Scan the QR code or copy-paste this link into your mobile browser.
        </div>
    </div>

    <!-- 2. Mobile Main Card -->
    <div id="mobile-content" class="bg-white p-8 rounded-3xl shadow-xl max-w-sm w-full text-center">
        <div class="text-4xl mb-4 text-purple-800">üèè</div>
        <h1 class="text-xl font-bold mb-2 text-gray-800">Join as Co-Scorer</h1>
        <p class="text-gray-500 text-sm mb-8">
            Click the button below to open the CrickMatch app and start scoring for this tournament.
        </p>
        
        <button id="joinBtn" class="w-full bg-[#4A3A8C] hover:bg-[#3b2e70] text-white font-bold py-4 rounded-2xl mb-4 shadow-lg active:scale-95 transition-transform">
            Open App to Join
        </button>
        
        <p class="text-[10px] text-gray-400">
            If CrickMatch is not installed, you will be redirected to the Play Store or App Store.
        </p>
    </div>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const tId = urlParams.get('id');
        const userAgent = navigator.userAgent || navigator.vendor || window.opera;

        // --- PC/Desktop Detection ---
        const isMobile = /android|iphone|ipad|ipod/i.test(userAgent);
        
        if (!isMobile) {
            document.getElementById('mobile-content').classList.add('hidden');
            document.getElementById('pc-error').classList.remove('hidden');
        }

        document.getElementById('joinBtn').onclick = () => {
            if (!tId) {
                alert("Invalid Invitation: Tournament ID is missing.");
                return;
            }

            const playStoreUrl = "https://play.google.com/store/apps/details?id=com.meetanshi.crickmatch";
            const appStoreUrl = "https://apps.apple.com/us/app/crickmatch-live-scorer/id6755029198";

            // --- Android Logic (Using Intent for better app detection) ---
            if (/android/i.test(userAgent)) {
                // This intent will try to open the app, if not found, it opens the play store automatically
                const intentUrl = `intent://join?id=${tId}#Intent;scheme=cricketscorer;package=com.meetanshi.crickmatch;S.browser_fallback_url=${playStoreUrl};end`;
                window.location.href = intentUrl;
            } 
            // --- iOS Logic ---
            else if (/iPad|iPhone|iPod/.test(userAgent)) {
                window.location.href = `cricketscorer://join?id=${tId}`;
                
                // Fallback to App Store if app doesn't open within 2.5 seconds
                setTimeout(() => {
                    if (!document.hidden) {
                        window.location.href = appStoreUrl;
                    }
                }, 2500);
            }
        };
    </script>
</body>
</html>
