<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CrickMatch Pro Center</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4A3A8C; /* Original Purple Color */
            --primary-dark: #372b6b;
            --accent: #634cb5;
        }
        body { 
            font-family: 'Outfit', sans-serif; 
            background-color: #f8fafc;
            color: #1e293b;
            -webkit-tap-highlight-color: transparent;
        }
        /* New Gradient Header based on Original Color */
        .header-gradient {
            background: linear-gradient(135deg, #4A3A8C 0%, #634cb5 100%);
        }
        
        .glass-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }

        /* Full Width Tabs Styling */
        .tab-container {
            position: sticky;
            top: 0;
            z-index: 40;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid #e2e8f0;
        }
        
        .tab-btn { 
            position: relative;
            color: #64748b;
            transition: all 0.3s ease;
        }
        
        .tab-active { 
            color: #4A3A8C; 
            font-weight: 700;
        }
        
        /* Animated underline for tabs */
        .tab-active::after {
            content: '';
            position: absolute;
            bottom: 0;
            left: 0;
            width: 100%;
            height: 3px;
            background-color: #4A3A8C;
            border-radius: 3px 3px 0 0;
        }

        .live-pulse {
            animation: pulse-red 2s infinite;
        }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.7); }
            70% { box-shadow: 0 0 0 6px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
    </style>
</head>
<body class="pb-32 select-none">

    <!-- Header Section (Original Purple) -->
    <div class="header-gradient text-white pt-8 pb-10 px-6 relative overflow-hidden rounded-b-[2rem] shadow-lg">
        <!-- Abstract Decoration -->
        <div class="absolute top-0 right-0 w-64 h-64 bg-white rounded-full mix-blend-overlay filter blur-3xl opacity-10 -mr-16 -mt-16"></div>
        <div class="absolute bottom-0 left-0 w-48 h-48 bg-purple-900 rounded-full mix-blend-overlay filter blur-3xl opacity-20 -ml-10 -mb-10"></div>

        <div class="relative z-10 text-center">
            <div class="inline-flex items-center gap-1.5 py-1 px-3 rounded-full bg-white/10 border border-white/20 mb-3 backdrop-blur-sm">
                <span class="w-1.5 h-1.5 rounded-full bg-green-400 animate-pulse"></span>
                <span class="text-[10px] font-bold tracking-widest uppercase text-white/90">Live Center</span>
            </div>
            <h1 id="tournament-name" class="text-3xl font-black tracking-tight leading-tight mb-2 drop-shadow-md">
                <span class="animate-pulse opacity-80">Loading...</span>
            </h1>
            <div class="flex items-center justify-center gap-2 text-purple-100 text-xs font-medium uppercase tracking-wide opacity-90">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"/></svg>
                <span id="tournament-detail">Fetching Location...</span>
            </div>
        </div>
    </div>

    <!-- Full Width Sticky Tabs -->
    <div class="tab-container shadow-sm">
        <div class="max-w-md mx-auto flex justify-between items-center overflow-x-auto no-scrollbar">
            <button onclick="switchTab('fixtures')" id="tab-fixtures" class="tab-btn tab-active flex-1 py-4 text-xs font-bold uppercase tracking-wider text-center">Matches</button>
            <button onclick="switchTab('teams')" id="tab-teams" class="tab-btn flex-1 py-4 text-xs font-bold uppercase tracking-wider text-center">Teams</button>
            <button onclick="switchTab('standings')" id="tab-standings" class="tab-btn flex-1 py-4 text-xs font-bold uppercase tracking-wider text-center">Table</button>
            <button onclick="switchTab('stats')" id="tab-stats" class="tab-btn flex-1 py-4 text-xs font-bold uppercase tracking-wider text-center">Stats</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-md mx-auto p-4 mt-2 space-y-6 min-h-[50vh]">
        
        <!-- 1. Fixtures Section -->
        <div id="content-fixtures" class="space-y-4 animate-fade-in">
            <div id="fixtures-list" class="space-y-4 pb-4"></div>
        </div>

        <!-- 2. Teams Section -->
        <div id="content-teams" class="hidden animate-fade-in">
             <div class="grid grid-cols-2 gap-4" id="teams-list"></div>
        </div>

        <!-- 3. Standings Section -->
        <div id="content-standings" class="hidden animate-fade-in">
            <div class="bg-white rounded-2xl overflow-hidden shadow-md border border-gray-100">
                <div class="bg-[#4A3A8C] p-3 text-white flex justify-between items-center">
                    <h3 class="font-bold text-sm uppercase tracking-wider">Points Table</h3>
                </div>
                <table class="w-full text-sm">
                    <thead>
                        <tr class="bg-gray-50 text-gray-500 font-bold text-[10px] uppercase border-b border-gray-100">
                            <th class="p-3 text-left pl-4">Team</th>
                            <th class="p-3 text-center">P</th>
                            <th class="p-3 text-center">W</th>
                            <th class="p-3 text-center">Pts</th>
                            <th class="p-3 text-right pr-4">NRR</th>
                        </tr>
                    </thead>
                    <tbody id="standings-body" class="divide-y divide-gray-50"></tbody>
                </table>
            </div>
        </div>

        <!-- 4. Stats Section -->
        <div id="content-stats" class="hidden animate-fade-in space-y-5">
            
            <!-- Batting Card -->
            <div class="bg-white rounded-2xl shadow-md border-t-4 border-orange-500 overflow-hidden">
                <div class="bg-orange-50 p-3 border-b border-orange-100 flex justify-between items-center">
                    <h3 class="font-bold text-orange-900 text-xs uppercase tracking-wider flex items-center gap-2">
                        <span>üèè</span> Most Runs
                    </h3>
                </div>
                <div id="top-batsmen" class="divide-y divide-gray-100"></div>
            </div>

            <!-- Bowling Card -->
            <div class="bg-white rounded-2xl shadow-md border-t-4 border-[#4A3A8C] overflow-hidden">
                <div class="bg-indigo-50 p-3 border-b border-indigo-100 flex justify-between items-center">
                    <h3 class="font-bold text-[#4A3A8C] text-xs uppercase tracking-wider flex items-center gap-2">
                        <span>üéØ</span> Most Wickets
                    </h3>
                </div>
                <div id="top-bowlers" class="divide-y divide-gray-100"></div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <div class="fixed bottom-0 left-0 right-0 p-4 bg-white/80 backdrop-blur-md border-t border-gray-200 z-50">
        <button id="open-app-btn" class="w-full max-w-sm mx-auto bg-[#4A3A8C] hover:bg-[#372b6b] text-white flex items-center justify-center gap-3 py-3.5 rounded-xl shadow-lg transition-all active:scale-95 group">
            <span class="bg-white/20 p-1.5 rounded-lg transition-colors">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 18h.01M8 21h8a2 2 0 002-2V5a2 2 0 00-2-2H8a2 2 0 00-2 2v14a2 2 0 002 2z"/></svg>
            </span>
            <span class="font-bold text-sm tracking-wide">Open in CrickMatch App</span>
        </button>
    </div>

    <!-- Firebase & Logic (No Changes to Logic) -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, doc, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: atob("QUl6YVN5RDNTUEZhNmI0dmc1bHdISzlobTd0SnV5aS05eFRyb0dJ"),
            authDomain: "cricket-scorer-app-a9d37.firebaseapp.com",
            projectId: "cricket-scorer-app-a9d37",
            storageBucket: "cricket-scorer-app-a9d37.appspot.com",
            messagingSenderId: "533428996475",
            appId: "1:533428996475:web:58161d5066d65ad2dd15de"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const params = new URLSearchParams(window.location.search);
        const tId = params.get('tournamentId');
        const ownerId = params.get('ownerId');

        if (tId && ownerId) {
            // Tournament Meta
            onSnapshot(doc(db, "users", ownerId, "tournaments", tId), (d) => {
                if(d.exists()){
                    const data = d.data();
                    document.getElementById('tournament-name').innerText = data.name;
                    document.getElementById('tournament-detail').innerText = `${data.groundName}, ${data.city}`;
                }
            });

            // Fixtures (Updated Visual Design only)
            onSnapshot(query(collection(db, "users", ownerId, "tournaments", tId, "fixtures"), orderBy("matchOrder")), (snap) => {
                const list = document.getElementById('fixtures-list');
                list.innerHTML = '';
                snap.forEach(doc => {
                    const f = doc.data();
                    let statusClass = "bg-gray-100 text-gray-500";
                    let statusText = f.status;
                    let livePulse = "";
                    let borderClass = "border-l-4 border-gray-200";

                    if(f.status === 'Live'){ 
                        statusClass = "bg-red-500 text-white"; 
                        statusText = "LIVE";
                        livePulse = "live-pulse border-red-500";
                        borderClass = "border-l-4 border-red-500";
                    }
                    else if(f.status === 'Completed'){ 
                        statusClass = "bg-green-500 text-white"; 
                        statusText = "DONE";
                        borderClass = "border-l-4 border-green-500";
                    }

                    list.innerHTML += `
                        <div class="bg-white rounded-xl shadow-sm p-0 relative overflow-hidden ${borderClass} transition-transform active:scale-[0.98]">
                            <div class="px-5 py-3 border-b border-gray-50 flex justify-between items-center bg-gray-50/50">
                                <span class="text-[10px] font-black text-gray-400 tracking-widest uppercase">MATCH ${f.matchNo}</span>
                                <span class="text-[9px] px-2 py-0.5 rounded font-bold uppercase tracking-wide ${statusClass} ${livePulse}">${statusText}</span>
                            </div>
                            <div class="p-5">
                                <div class="flex items-center justify-between gap-2">
                                    <div class="flex-1 flex flex-col items-center gap-2">
                                        <div class="w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center text-lg font-black text-gray-600">
                                            ${f.teamA_name.charAt(0)}
                                        </div>
                                        <span class="text-xs font-bold text-gray-800 text-center leading-tight">${f.teamA_name}</span>
                                    </div>
                                    
                                    <div class="font-black text-gray-200 text-xl italic">VS</div>

                                    <div class="flex-1 flex flex-col items-center gap-2">
                                        <div class="w-12 h-12 bg-gray-100 rounded-xl flex items-center justify-center text-lg font-black text-gray-600">
                                            ${f.teamB_name.charAt(0)}
                                        </div>
                                        <span class="text-xs font-bold text-gray-800 text-center leading-tight">${f.teamB_name}</span>
                                    </div>
                                </div>
                            </div>
                            ${f.resultSummary ? `
                                <div class="bg-indigo-50/50 px-4 py-2 border-t border-indigo-50">
                                    <p class="text-center text-[10px] font-bold text-[#4A3A8C]">
                                        ${f.resultSummary}
                                    </p>
                                </div>
                            ` : ''}
                        </div>`;
                });
            });

            // Teams
            onSnapshot(collection(db, "users", ownerId, "tournaments", tId, "teams"), (snap) => {
                const list = document.getElementById('teams-list');
                list.innerHTML = '';
                snap.forEach(doc => {
                    const t = doc.data();
                    list.innerHTML += `
                        <div class="bg-white rounded-2xl p-4 flex flex-col items-center justify-center gap-2 shadow-sm border border-gray-100">
                            <div class="w-12 h-12 bg-[#4A3A8C] text-white rounded-xl flex items-center justify-center text-lg font-black shadow-lg shadow-purple-200">
                                ${t.teamName.charAt(0)}
                            </div>
                            <div class="font-bold text-xs text-gray-800 text-center leading-tight">${t.teamName}</div>
                        </div>`;
                });
            });

            // Standings
            onSnapshot(query(collection(db, "users", ownerId, "tournaments", tId, "standings"), orderBy("points", "desc")), (snap) => {
                const body = document.getElementById('standings-body');
                body.innerHTML = '';
                let rank = 1;
                snap.forEach(doc => {
                    const s = doc.data();
                    body.innerHTML += `
                        <tr class="hover:bg-gray-50 transition-colors">
                            <td class="p-3 pl-4 flex items-center gap-2">
                                <span class="text-[9px] w-4 h-4 flex items-center justify-center rounded-full bg-gray-100 text-gray-500 font-bold">${rank}</span>
                                <span class="font-bold text-gray-700 text-xs">${s.teamName}</span>
                            </td>
                            <td class="p-3 text-center text-gray-500 text-xs font-medium">${s.played}</td>
                            <td class="p-3 text-center text-gray-500 text-xs font-medium">${s.won}</td>
                            <td class="p-3 text-center font-black text-[#4A3A8C]">${s.points}</td>
                            <td class="p-3 pr-4 text-right text-[10px] font-mono text-gray-400">${(s.nrr || 0).toFixed(3)}</td>
                        </tr>`;
                    rank++;
                });
            });

            // Stats
            onSnapshot(query(collection(db, "users", ownerId, "tournaments", tId, "playerStats"), orderBy("runs", "desc")), (snap) => {
                const list = document.getElementById('top-batsmen');
                list.innerHTML = '';
                let i = 1;
                snap.forEach(doc => {
                    if(i <= 5) {
                        const p = doc.data();
                        list.innerHTML += `
                        <div class="px-4 py-3 flex justify-between items-center hover:bg-orange-50/50 transition-colors">
                            <div class="flex items-center gap-3">
                                <span class="text-[10px] font-bold w-4 text-center text-gray-400">#${i}</span>
                                <div class="font-bold text-gray-800 text-xs">${p.playerName}</div>
                            </div>
                            <span class="font-black text-sm text-orange-600">${p.runs}</span>
                        </div>`;
                    }
                    i++;
                });
            });

            onSnapshot(query(collection(db, "users", ownerId, "tournaments", tId, "playerStats"), orderBy("wickets", "desc")), (snap) => {
                const list = document.getElementById('top-bowlers');
                list.innerHTML = '';
                let i = 1;
                snap.forEach(doc => {
                    if(i <= 5) {
                        const p = doc.data();
                        list.innerHTML += `
                        <div class="px-4 py-3 flex justify-between items-center hover:bg-indigo-50/50 transition-colors">
                            <div class="flex items-center gap-3">
                                <span class="text-[10px] font-bold w-4 text-center text-gray-400">#${i}</span>
                                <div class="font-bold text-gray-800 text-xs">${p.playerName}</div>
                            </div>
                            <span class="font-black text-sm text-[#4A3A8C]">${p.wickets}</span>
                        </div>`;
                    }
                    i++;
                });
            });

            document.getElementById('open-app-btn').onclick = () => {
                window.location.href = `cricketscorer://tournament?id=${tId}&ownerId=${ownerId}`;
            };
        }

        window.switchTab = (tab) => {
            const tabs = ['fixtures', 'teams', 'standings', 'stats'];
            tabs.forEach(t => {
                const content = document.getElementById(`content-${t}`);
                const btn = document.getElementById(`tab-${t}`);
                
                content.classList.add('hidden');
                btn.classList.remove('tab-active');
            });
            
            document.getElementById(`content-${tab}`).classList.remove('hidden');
            const activeBtn = document.getElementById(`tab-${tab}`);
            activeBtn.classList.add('tab-active');
        };
    </script>
</body>
</html>
