<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>CrickMatch Pro Center</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700;800&family=Bebas+Neue&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary: #4A3A8C;
            --secondary: #634cb5;
            --surface: #ffffff;
            --bg: #f1f5f9;
        }
        body { 
            font-family: 'Outfit', sans-serif; 
            background-color: var(--bg);
            color: #0f172a;
            -webkit-tap-highlight-color: transparent;
        }
        .header-curve {
            background: linear-gradient(135deg, #4A3A8C 0%, #634cb5 100%);
            border-bottom-left-radius: 3rem;
            border-bottom-right-radius: 3rem;
            box-shadow: 0 10px 25px -5px rgba(74, 58, 140, 0.3);
        }
        .tab-sticky {
            position: sticky;
            top: 0;
            z-index: 50;
            background: rgba(255, 255, 255, 0.8);
            backdrop-filter: blur(12px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
        }
        .tab-btn {
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        .tab-active {
            color: var(--primary);
            font-weight: 800;
            transform: scale(1.1);
        }
        .tab-active::after {
            content: '';
            position: absolute;
            bottom: 8px;
            left: 50%;
            transform: translateX(-50%);
            width: 6px;
            height: 6px;
            background: var(--primary);
            border-radius: 50%;
        }
        .match-card {
            background: white;
            border-radius: 24px;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(226, 232, 240, 0.5);
        }
        .match-card:active { transform: scale(0.97); }
        .vs-badge {
            font-family: 'Bebas Neue', cursive;
            background: #f8fafc;
            color: #cbd5e1;
            padding: 4px 10px;
            border-radius: 12px;
            border: 1px solid #f1f5f9;
        }
        .team-initial {
            width: 54px;
            height: 54px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: 1.5rem;
            border-radius: 18px;
            box-shadow: 0 8px 15px -3px rgba(0,0,0,0.1);
        }
        .status-live {
            background: #ef4444;
            color: white;
            animation: pulse-red 2s infinite;
        }
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0.5); }
            70% { box-shadow: 0 0 0 8px rgba(239, 68, 68, 0); }
            100% { box-shadow: 0 0 0 0 rgba(239, 68, 68, 0); }
        }
        .rank-badge {
            background: linear-gradient(135deg, #f59e0b, #d97706);
            color: white;
            font-size: 0.65rem;
            padding: 2px 6px;
            border-radius: 6px;
            font-weight: 800;
        }
        .no-scrollbar::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="pb-28">

    <!-- Professional Header -->
    <div class="header-curve text-white pt-12 pb-20 px-8 relative overflow-hidden">
        <div class="absolute top-[-10%] right-[-10%] w-48 h-48 bg-white/10 rounded-full blur-3xl"></div>
        <div class="relative z-10">
            <div class="flex items-center justify-center gap-2 mb-4">
                <span class="px-3 py-1 bg-white/20 backdrop-blur-md rounded-full text-[10px] font-black uppercase tracking-[0.2em]">Official Tournament</span>
            </div>
            <h1 id="tournament-name" class="text-3xl font-extrabold text-center tracking-tight mb-2 drop-shadow-lg">Loading...</h1>
            <div class="flex items-center justify-center gap-2 text-white/70 text-xs font-medium">
                <svg class="w-3.5 h-3.5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"/></svg>
                <span id="tournament-detail" class="tracking-wide">Fetching Location...</span>
            </div>
        </div>
    </div>

    <!-- Modern Sticky Navigation -->
    <div class="tab-sticky -mt-8 mx-6 rounded-3xl shadow-xl border-none">
        <div class="flex justify-around items-center px-2">
            <button onclick="switchTab('fixtures')" id="tab-fixtures" class="tab-btn tab-active py-5 px-3 text-[11px] font-bold uppercase tracking-wider">Matches</button>
            <button onclick="switchTab('teams')" id="tab-teams" class="tab-btn py-5 px-3 text-[11px] font-bold uppercase tracking-wider text-slate-400">Teams</button>
            <button onclick="switchTab('standings')" id="tab-standings" class="tab-btn py-5 px-3 text-[11px] font-bold uppercase tracking-wider text-slate-400">Table</button>
            <button onclick="switchTab('stats')" id="tab-stats" class="tab-btn py-5 px-3 text-[11px] font-bold uppercase tracking-wider text-slate-400">Stats</button>
        </div>
    </div>

    <!-- Main Content -->
    <div class="max-w-md mx-auto p-5 mt-4">
        
        <!-- Fixtures Tab -->
        <div id="content-fixtures" class="space-y-5">
            <div id="fixtures-list" class="space-y-5"></div>
        </div>

        <!-- Teams Tab -->
        <div id="content-teams" class="hidden">
            <div class="grid grid-cols-2 gap-4" id="teams-list"></div>
        </div>

        <!-- Standings Tab -->
        <div id="content-standings" class="hidden">
            <div class="bg-white rounded-[2rem] shadow-xl overflow-hidden border border-slate-100">
                <table class="w-full">
                    <thead>
                        <tr class="bg-slate-50/50 text-slate-400 font-bold text-[10px] uppercase">
                            <th class="py-5 px-4 text-left">Squad</th>
                            <th class="py-5 px-2 text-center">P</th>
                            <th class="py-5 px-2 text-center">W</th>
                            <th class="py-5 px-2 text-center">Pts</th>
                            <th class="py-5 px-4 text-right">NRR</th>
                        </tr>
                    </thead>
                    <tbody id="standings-body" class="divide-y divide-slate-50"></tbody>
                </table>
            </div>
        </div>

        <!-- Stats Tab -->
        <div id="content-stats" class="hidden space-y-6">
            <div class="bg-white rounded-[2rem] p-6 shadow-xl border-l-8 border-[#4A3A8C]">
                <h3 class="text-sm font-black text-slate-800 uppercase tracking-widest mb-4 flex items-center gap-2">
                    <span class="p-2 bg-indigo-50 rounded-lg">üèè</span> Top Batters
                </h3>
                <div id="top-batsmen" class="space-y-4"></div>
            </div>

            <div class="bg-white rounded-[2rem] p-6 shadow-xl border-l-8 border-orange-500">
                <h3 class="text-sm font-black text-slate-800 uppercase tracking-widest mb-4 flex items-center gap-2">
                    <span class="p-2 bg-orange-50 rounded-lg">üéØ</span> Top Bowlers
                </h3>
                <div id="top-bowlers" class="space-y-4"></div>
            </div>
        </div>
    </div>

    <!-- App Call-to-Action -->
    <div class="fixed bottom-0 left-0 right-0 p-5 bg-white/70 backdrop-blur-xl border-t border-slate-100 z-[60]">
        <button id="open-app-btn" class="w-full max-w-sm mx-auto bg-[#1e1b4b] hover:bg-black text-white flex items-center justify-between p-2 pl-6 rounded-2xl shadow-2xl shadow-indigo-200 transition-all group">
            <span class="font-bold text-sm tracking-tight">Experience Live in App</span>
            <div class="bg-white/10 p-3 rounded-xl group-hover:bg-white/20 transition-colors">
                <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="3" d="M14 5l7 7m0 0l-7 7m7-7H3"/></svg>
            </div>
        </button>
    </div>

    <!-- Scripts -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getFirestore, doc, collection, onSnapshot, query, orderBy } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: atob("QUl6YVN5RDNTUEZhNmI0dmc1bHdISzlobTd0SnV5aS05eFRyb0dJ"),
            authDomain: "cricket-scorer-app-a9d37.firebaseapp.com",
            projectId: "cricket-scorer-app-a9d37",
            storageBucket: "cricket-scorer-app-a9d37.appspot.com",
            messagingSenderId: "533428996475",
            appId: "1:533428996475:web:58161d5066d65ad2dd15de"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const params = new URLSearchParams(window.location.search);
        const tId = params.get('tournamentId');
        const ownerId = params.get('ownerId');

        if (tId && ownerId) {
            onSnapshot(doc(db, "users", ownerId, "tournaments", tId), (d) => {
                if(d.exists()){
                    const data = d.data();
                    document.getElementById('tournament-name').innerText = data.name;
                    document.getElementById('tournament-detail').innerText = `${data.groundName}, ${data.city}`;
                }
            });

            // Fixtures Design (Unique & Modern)
            onSnapshot(query(collection(db, "users", ownerId, "tournaments", tId, "fixtures"), orderBy("matchOrder")), (snap) => {
                const list = document.getElementById('fixtures-list');
                list.innerHTML = '';
                snap.forEach(doc => {
                    const f = doc.data();
                    let statusColor = "bg-slate-100 text-slate-400";
                    let liveClass = "";
                    if(f.status === 'Live') { statusColor = "status-live"; liveClass = "Live"; }
                    else if(f.status === 'Completed') { statusColor = "bg-emerald-500 text-white"; }

                    list.innerHTML += `
                        <div class="match-card shadow-lg shadow-slate-200/50">
                            <div class="px-6 py-3 flex justify-between items-center bg-slate-50/50 border-b border-slate-100">
                                <span class="text-[9px] font-black text-slate-400 uppercase tracking-[0.15em]">Match ${f.matchNo}</span>
                                <span class="text-[8px] px-3 py-1 rounded-full font-black uppercase tracking-widest ${statusColor}">${f.status}</span>
                            </div>
                            <div class="p-8 flex items-center justify-between">
                                <div class="flex-1 flex flex-col items-center gap-3">
                                    <div class="team-initial bg-indigo-50 text-[#4A3A8C]">${f.teamA_name.charAt(0)}</div>
                                    <span class="text-xs font-black text-slate-800 text-center uppercase tracking-tight">${f.teamA_name}</span>
                                </div>
                                <div class="vs-badge">VS</div>
                                <div class="flex-1 flex flex-col items-center gap-3">
                                    <div class="team-initial bg-orange-50 text-orange-600">${f.teamB_name.charAt(0)}</div>
                                    <span class="text-xs font-black text-slate-800 text-center uppercase tracking-tight">${f.teamB_name}</span>
                                </div>
                            </div>
                            ${f.resultSummary ? `
                                <div class="mx-6 mb-6 p-3 bg-indigo-50/50 rounded-2xl border border-indigo-100/50 text-center">
                                    <p class="text-[10px] font-bold text-[#4A3A8C] leading-relaxed">${f.resultSummary}</p>
                                </div>
                            ` : ''}
                        </div>`;
                });
            });

            // Teams (Unique Card Design)
            onSnapshot(collection(db, "users", ownerId, "tournaments", tId, "teams"), (snap) => {
                const list = document.getElementById('teams-list');
                list.innerHTML = '';
                snap.forEach(doc => {
                    const t = doc.data();
                    list.innerHTML += `
                        <div class="bg-white rounded-3xl p-5 flex flex-col items-center gap-3 shadow-md border border-slate-50">
                            <div class="w-16 h-16 bg-gradient-to-br from-indigo-50 to-white text-[#4A3A8C] rounded-2xl flex items-center justify-center text-xl font-black shadow-inner">
                                ${t.teamName.charAt(0)}
                            </div>
                            <span class="font-bold text-xs text-slate-800 text-center">${t.teamName}</span>
                        </div>`;
                });
            });

            // Standings (Premium Table)
            onSnapshot(query(collection(db, "users", ownerId, "tournaments", tId, "standings"), orderBy("points", "desc")), (snap) => {
                const body = document.getElementById('standings-body');
                body.innerHTML = '';
                let rank = 1;
                snap.forEach(doc => {
                    const s = doc.data();
                    body.innerHTML += `
                        <tr class="text-slate-600">
                            <td class="py-5 px-4">
                                <div class="flex items-center gap-3">
                                    <span class="rank-badge">${rank}</span>
                                    <span class="font-bold text-slate-800 text-xs">${s.teamName}</span>
                                </div>
                            </td>
                            <td class="py-5 px-2 text-center text-xs font-medium">${s.played}</td>
                            <td class="py-5 px-2 text-center text-xs font-medium">${s.won}</td>
                            <td class="py-5 px-2 text-center font-black text-[#4A3A8C]">${s.points}</td>
                            <td class="py-5 px-4 text-right text-[10px] font-mono font-bold text-slate-400">${(s.nrr || 0).toFixed(3)}</td>
                        </tr>`;
                    rank++;
                });
            });

            // Stats
            onSnapshot(query(collection(db, "users", ownerId, "tournaments", tId, "playerStats"), orderBy("runs", "desc")), (snap) => {
                const list = document.getElementById('top-batsmen');
                list.innerHTML = '';
                let i = 1;
                snap.forEach(doc => {
                    if(i <= 5) {
                        const p = doc.data();
                        list.innerHTML += `
                            <div class="flex justify-between items-center p-1">
                                <div class="flex items-center gap-3">
                                    <span class="text-[10px] font-black text-slate-300 w-4">0${i}</span>
                                    <span class="text-xs font-bold text-slate-700">${p.playerName}</span>
                                </div>
                                <span class="text-xs font-black text-slate-900 bg-slate-50 px-3 py-1 rounded-lg">${p.runs} <span class="text-[9px] text-slate-400 font-normal">Runs</span></span>
                            </div>`;
                    }
                    i++;
                });
            });

            onSnapshot(query(collection(db, "users", ownerId, "tournaments", tId, "playerStats"), orderBy("wickets", "desc")), (snap) => {
                const list = document.getElementById('top-bowlers');
                list.innerHTML = '';
                let i = 1;
                snap.forEach(doc => {
                    if(i <= 5) {
                        const p = doc.data();
                        list.innerHTML += `
                            <div class="flex justify-between items-center p-1">
                                <div class="flex items-center gap-3">
                                    <span class="text-[10px] font-black text-slate-300 w-4">0${i}</span>
                                    <span class="text-xs font-bold text-slate-700">${p.playerName}</span>
                                </div>
                                <span class="text-xs font-black text-orange-600 bg-orange-50 px-3 py-1 rounded-lg">${p.wickets} <span class="text-[9px] text-orange-300 font-normal">Wkts</span></span>
                            </div>`;
                    }
                    i++;
                });
            });

            document.getElementById('open-app-btn').onclick = () => {
                window.location.href = `cricketscorer://tournament?id=${tId}&ownerId=${ownerId}`;
            };
        }

        window.switchTab = (tab) => {
            ['fixtures', 'teams', 'standings', 'stats'].forEach(t => {
                document.getElementById(`content-${t}`).classList.add('hidden');
                document.getElementById(`tab-${t}`).classList.remove('tab-active');
                document.getElementById(`tab-${t}`).classList.add('text-slate-400');
            });
            document.getElementById(`content-${tab}`).classList.remove('hidden');
            document.getElementById(`tab-${tab}`).classList.add('tab-active');
        };
    </script>
</body>
</html>
